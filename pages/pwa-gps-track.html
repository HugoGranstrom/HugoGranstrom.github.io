---
permalink: /pwa-gps-track/
---

<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
        #map {height: 500px;}
        #startbtn {margin: 20px;}
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css"
   integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
   crossorigin=""/>
   <!-- Make sure you put this AFTER Leaflet's CSS -->
 <script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js"
 integrity="sha512-tAGcCfR4Sc5ZP5ZoVz0quoZDYX5aCtEm/eu1KhSLj2c9eFrylXZknQYmxUssFaVJKvvc0dJQixhGjG2yXWiV9Q=="
 crossorigin=""></script>
  </head>
  <body>
    <div id="map"></div>
    <button id="startbtn" onclick="start_track()">Start</button>
    <button id="stopbtn" onclick="stop_track()">Stop</button>
    <script>
        mymap = L.map('map').setView([0, 0], 13);
        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiaHVnb2dyYW5zdHJvbSIsImEiOiJjamwzbjJqYjkxd2x4M3Bxcm16aWU3aWxmIn0.w0m_edRTF8MH_gpv7IvKSg', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            id: 'mapbox.streets'
        }).addTo(mymap);

        function start_track() {
            timer = setInterval(updatePosition, 1000);
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    startPosition = [position.coords.latitude, position.coords.longitude];
                    console.log(startPosition);
                    track_line = L.polyline([startPosition], {color: 'red'}).addTo(mymap);
                    L.popup()
                        .setLatLng(startPosition)
                        .setContent('Start')
                        .openOn(mymap);
                    console.log("Start tracking");
                });
            }
            
            
        }
        function stop_track() {
            clearInterval(timer);
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    endPosition = [position.coords.latitude, position.coords.longitude];
                    L.popup()
                        .setLatLng(endPosition)
                        .setContent('Finish')
                        .openOn(mymap);
                });
            }
            console.log("end");
            
        }

        function updatePosition() {
            console.log("update");
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    position = [position.coords.latitude, position.coords.longitude];
                    track_line.addLatLng(position);
                    mymap.fitBounds(track_line.getBounds());
                });
            }
            
        }
    </script>
  </body>
</html>